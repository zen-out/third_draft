const arrz = require("array_helperz")
const { getAllTagSnippetJoins, getAllProblemJoins, getAllCheatsheetJoins, getAllTaskJoins } = require("./oneToMany.js")
const { knex } = require("./knex")


async function masterProblems(knex, user_id) {
    let merged = await getAllProblemJoins(knex, user_id)
    let result = arrz.filterWithFuncObjectOrString(merged, { usefulness: 1, importance: 1 })
    let sorted = arrz.sortDesc(result, "created", "date")
    return sorted;
}
async function masterCheatsheets(knex, user_id) {
    let trimmed = await getAllCheatsheetJoins(knex, user_id)
    let result = arrz.filterWithFuncObjectOrString(trimmed, { usefulness: 1, importance: 1 })
    let sorted = arrz.sortDesc(result, "created", "date")
    return sorted;
}
async function masterTasks(knex, user_id) {
    let trimmed = await getAllTaskJoins(knex, user_id)
    let result = arrz.filterWithFuncObjectOrString(trimmed, { usefulness: 1, importance: 1 })
    let sorted = arrz.sortDesc(result, "created", "date")
    return sorted;
}
async function masterTagSnippets(knex, user_id) {
    let trimmed = await getAllTagSnippetJoins(knex, user_id)
    let result = arrz.filterWithFuncObjectOrString(trimmed, { usefulness: 1, importance: 1 })
    let sorted = arrz.sortDesc(result, "created", "date")
    return sorted;
}
async function testJoy() {
    let problems = await masterProblems(knex, 1)
    console.log(problems[0])
    console.log(problems[problems.length - 1])
    let tasks = await masterTasks(knex, 1)
    let tagsnippets = await masterTagSnippets(knex, 1)
    let cheatsheets = await masterCheatsheets(knex, 1)
}

module.exports = { masterProblems, masterCheatsheets, masterTasks, masterTagSnippets, testJoy };