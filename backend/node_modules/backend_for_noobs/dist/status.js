const arrz = require("array_helperz")
const { getAllTagSnippetJoins, getAllProblemJoins, getAllCheatsheetJoins, getAllTaskJoins } = require("./oneToMany.js")
const make_legit = require("make_legit")
const { knex } = require("./knex")


async function statusOfProblems(knex, user_id) {
    let merged = await getAllProblemJoins(knex, user_id)
    let todo = arrz.contains(merged, "status", "to do")
    let doing = arrz.contains(merged, "status", "doing")
    let done = arrz.contains(merged, "status", "done")
    let none = arrz.contains(merged, "status", null)
    let together = [...todo, ...doing, ...done, ...none]
    return together;
}
async function statusOfCheatsheets(knex, user_id) {
    let trimmed = await getAllCheatsheetJoins(knex, user_id)
    let todo = arrz.contains(trimmed, "status", "to do")
    let doing = arrz.contains(trimmed, "status", "doing")
    let done = arrz.contains(trimmed, "status", "done")
    let none = arrz.contains(trimmed, "status", null)
    let together = [...todo, ...doing, ...done, ...none]
    return together;
}
async function statusOfTasks(knex, user_id) {
    let trimmed = await getAllTaskJoins(knex, user_id)
    let todo = arrz.contains(trimmed, "status", "to do")
    let doing = arrz.contains(trimmed, "status", "doing")
    let done = arrz.contains(trimmed, "status", "done")
    let none = arrz.contains(trimmed, "status", null)
    let together = [...todo, ...doing, ...done, ...none]
    return together;
}
async function statusOfTagSnippets(knex, user_id) {
    let trimmed = await getAllTagSnippetJoins(knex, user_id)
    let todo = arrz.contains(trimmed, "status", "to do")
    let doing = arrz.contains(trimmed, "status", "doing")
    let done = arrz.contains(trimmed, "status", "done")
    let none = arrz.contains(trimmed, "status", null)
    let together = [...todo, ...doing, ...done, ...none]
    return together;
}
async function testStatus() {
    let problems = await statusOfProblems(knex, 1)
    console.log(problems[0])
    console.log(problems[problems.length - 1])
    let tasks = await statusOfTasks(knex, 1)
    let tagsnippets = await statusOfTagSnippets(knex, 1)
    let cheatsheets = await statusOfCheatsheets(knex, 1)
}

module.exports = { statusOfProblems, statusOfCheatsheets, statusOfTasks, statusOfTagSnippets, testStatus };