const { see } = require("code_clarity")
const make_legit = require("make_legit")
const { upset } = require("whats_wrong")
const express = require("express")
const noobs = require("backend_for_noobs")
const router = express.Router()
const { knex } = require("./knex")
router.post("/api/signup", async(req, res) => {
    try {
        let getSignup = await noobs.signup(knex, req.body)
        res.send(getSignup).status(200)
    } catch (error) {
        let json = JSON.stringify(error)
        res.send(upset(`${json} error`, "signup", "should be able to signup")).status(400)
    }
})
router.post("/api/login", async(req, res) => {
    try {
        let getLogin = await noobs.login(knex, req.body)
        res.send(getLogin).status(200)
    } catch (error) {
        let json = JSON.stringify(error)
        res.send(upset(`${json} error`, "signup", "should be able to signup")).status(400)
    }
})
router.post("/api/logout/:user_id", async(req, res) => {
    let user_id = req.params.user_id
    try {
        let logout = await noobs.logout(knex, user_id)
        if (logout === true) {
            res.redirect("/login")
        } else {
            let json = JSON.stringify(error)
            res.send(upset(`${json} error`, "logout", "should be able to logout")).status(400)
        }
    } catch (error) {
        res.send(upset("signup", "signup.js", "should be able to signup"))
    }

})
module.exports = router