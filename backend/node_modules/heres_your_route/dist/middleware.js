const noobs = require("backend_for_noobs")
const UAParser = require("ua-parser-js")


const { knex } = require("./knex")

function ensureLatestBrowser(req) {
    var parser = new UAParser();
    var ua = req.headers['user-agent'];
    var browserName = parser.setUA(ua).getBrowser().name;
    return browserName.toLowerCase();
}

async function verifyLogin(req, res, next) {

    next()
        // let user_id;
        // if (req.body.user_id) {
        //     user_id = parseInt(req.body.user_id)
        // } else if (req.params.user_id) {
        //     user_id = parseInt(req.params.user_id)
        // } else {
        //     res.redirect("/login")
        // }
        // let verified = await noobs.verifyUserRoute(knex, user_id)
        // if (verified === true) {
        //     next()
        // } else {
        //     res.redirect("/login")
        // }
}

function getClientInfo(req, res, next) {
    let getDevice = ensureLatestBrowser(req)
    let getType = req.device.type.toLowerCase()
    req.body["device"] = getDevice;
    req.body["type"] = getType;
    next()
}

module.exports = { verifyLogin, ensureLatestBrowser, getClientInfo };