const { see } = require("code_clarity")
const { upset } = require("whats_wrong")
const express = require("express")
const noobs = require("backend_for_noobs")
const router = express.Router()

const { knex } = require("./knex")

router.get("/api/user/:user_id/search/problem/:query", async(req, res, next) => {
    let query = req.params.query;
    let user_id = parseInt(req.params.user_id)
    try {
        results = await noobs.searchProblems(knex, user_id, query)
    } catch (error) {
        res.send(upset("get", "get.js", "should be able to get problems")).status(400)
    }
    res.send(results).status(200)
})


router.get("/api/user/:user_id/search/cheatsheet/:query", async(req, res, next) => {
    let query = req.params.query;
    let user_id = parseInt(req.params.user_id)
    try {
        results = await noobs.searchCheatsheets(knex, user_id, query)
    } catch (error) {
        res.send(upset("get", "get.js", "should be able to get problems")).status(400)
    }
    res.send(results).status(200)
})


router.get("/api/user/:user_id/search/task/:query", async(req, res, next) => {
    let query = req.params.query;
    let user_id = parseInt(req.params.user_id)
    try {
        results = await noobs.searchTasks(knex, user_id, query)
    } catch (error) {
        res.send(upset("get", "get.js", "should be able to get problems")).status(400)
    }
    res.send(results).status(200)
})


router.get("/api/user/:user_id/search/tag_snippet/:query", async(req, res, next) => {
    let query = req.params.query;
    let user_id = parseInt(req.params.user_id)
    try {
        results = await noobs.searchTagSnippets(knex, user_id, query)
    } catch (error) {
        res.send(upset("get", "get.js", "should be able to get problems")).status(400)
    }
    res.send(results).status(200)
})


module.exports = router